<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Agent Based Model</title>
    </head>
    <body>
        <canvas id="canvas" width="800" height="600"></canvas>

        <script type="text/javascript">
            Number.prototype.mod = function(n) {
                return ((this % n) + n) % n;
            };

            var eps = 10;


            function World(){
                this.Agents = [];
            }

            World.prototype.nextState = function(){
                for (var i = 0; i < this.Agents.length; i++) {
                    this.Agents[i].move();
                }
            }

            World.prototype.render = function(ctx){
                for (var i = 0; i < this.Agents.length; i++) {
                    this.Agents[i].render(ctx);
                }
            }

            World.prototype.randomInit = function(cnt, width, height){
                for (var i = 0; i < cnt; i++) {
                    var ag = new Agent(new Vector(Math.random() * width, Math.random() * height));
                    this.Agents.push(ag);
                }
            }


            function Status(value){
                this.value = value || 0;
            }

            Status.prototype.background = function(){
                return '#000';
            }


            function Vector(x, y){
                this.x = x || 0;
                this.y = y || 0;
            }

            Vector.prototype.length = function(){
                return Math.sqrt(this.x * this.x + this.y * this.y);
            }

            Vector.prototype.distance = function(vect){
                return Math.sqrt((this.x - vect.x) * (this.x - vect.x) + (this.y - vect.y) * (this.y - vect.y));
            }

            Vector.prototype.direction = function(vect){
                return new Vector(vect.x - this.x, vect.y - this.y);
            }

            Vector.prototype.translate = function(vect){
                this.x += vect.x;
                this.y += vect.y
                return this;
            }

            Vector.prototype.normalize = function(){
                var len = this.length();
                this.x /= len;
                this.y /= len;
                return this;
            }

            Vector.prototype.scale = function(n){
                this.x *= n;
                this.y *=  n;
                return this;
            }


            function Agent(pos, state){
                this.pos = pos || new Vector();
                this.size = 2 + Math.random() * 3;
                this.speed = 1 + Math.random() * 3;
                this.direction = 0;
                this.state = state || new Status();
            }

            Agent.prototype.move = function(){
                this.direction += Math.random() / 2 - 0.25;
                var translateVect = new Vector(this.speed * Math.cos(this.direction), this.speed * Math.sin(this.direction));
                this.pos.translate(translateVect);
            }

            Agent.prototype.render = function(ctx){
                ctx.beginPath();
                ctx.fillStyle = this.state.background();
                ctx.arc(this.pos.x.mod(800), this.pos.y.mod(600), this.size, 0, 2 * Math.PI);
                ctx.fill();
                ctx.closePath();
            }


            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            var world = new World();
            world.randomInit(200, 800, 800);

            function animate(){
                clear();
                world.nextState();
                world.render(ctx);
                window.requestAnimationFrame(animate);
            }
            animate();


            function clear(){
                ctx.fillStyle = '#fff';
                ctx.fillRect(0, 0, canvas.width, canvas.height)
            }

        </script>

    </body>
</html>
